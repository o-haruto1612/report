## 2. ビルド・デバッグの方法

今回のビルドではVScodeのdevcontainerの拡張機能を用いてビルドを行いました。
手順は以下のとおりです。
#### 1. Dockerのインストール
Dockerをまず簡単に説明すると、Mastodonを起動するためには仮想サーバーを立てる必要があります。今回後に明らかになりますが、Dockerを用いて仮想サーバーを立てることで簡単にMastodonを起動することができます。Dockerのインストールは以下のとおりです。

$ sudo su -
# apt update
# apt install -y docker.io

と書くことでドッカーをインストールすることができます。このときにそのまま実行しようとすると、root権限が要求される可能性があります。その際には以下の通りに書いて実行してください。

# sudo usermod -aG docker your_username
# sudo systemctl restart docker

#### 2. mastodonのOSSのダウンロード

以上まで終わったらmastodonのオープンソースをダウンロードしてきましょう。Mastodonのオープンソースはgithubにおいてあります。リンクはこちら[https://github.com/mastodon/mastodon]

ここに写真を挿入

ページの緑になっているボタンをクリックするとLocalとCodespaceの選択肢が出てきます。どちらでも共同作業をすることはできますが、今回はVScodeを用いるので、Localの方を選択し、HTTPSのところからリンクを取得します。githubにあるフォルダのように共同作業するためにおいてあるフォルダのことをリモートリポジトリといいます。対して、個人で作業するために自分のパソコンにダウンロードしてきたものをローカルリポジトリといいます。

作業している個人がすべてgithub上に存在するファイルに書き込んでしまうと、変更が干渉しあってしまうことが考えられるためこのように作業します。

以下に作業する際に出てくる用語を説明しておきます。

クローン(clone)
:リモートリポジトリからローカル(自分のパソコン)に持ってくること（ダウンロードとほぼ同じ）その際のコマンドは、

#git clone <ダウンロードするリンク>

先に緑のボタンをクリックして取得したリンクを使うとmastodonのOSSをローカルに持ってくることができます。

ステージ(stage)
ローカルのファイルに変更を加えたときにどの変更をリモートリポジトリに上げるのか選ぶことができます。その際のコマンドが

#git add <選びたいファイル>

もしすべての変更をステージしたいのであれば<選びたいファイル>を「.」（コンマ）に置き換えると可能です。

コミット(commit)
ステージしたいものをステージしたらその変更をコミットすることでリモートリポジトリにあげることができます。その際のコマンドは、

#git commit -m "好きなコメント"

しかしステージとコミットだけでは本体に変更を加えることになるのでもとに戻すことができなくなってしまいます。

ブランチ(branch)
このときに登場するのがブランチというものです。ブランチについては良いページがあるのでここ[]を参照してください。

#### 3.devcontainerでmastodonを立ち上げる。
まずVScodeが自分の環境に入っていることを確認してください。VScodeが入っていることを確認したらその拡張機能としてdevcontainerをインストールしてください。

devcontainerとは何か、よくわからない人に向けて少し説明しておきます。詳しくはここ[https://blog.kinto-technologies.com/posts/2022-12-10-VSCodeDevContainer/]を参照してください。
devcontainerを用いる最大のメリットはバージョンの違いによってバグが起きないことだと思います。devcontainerで環境構築すると必要なものを勝手にダウンロードしてくれるので、手順がかなり単純化されます。

devcontainerの拡張機能をインストールしたら、mastodonのフォルダを開き、左下の青いボタンをクリックしてください

写真を乗せる。

ここをクリックすると、

写真を乗せる。

ここにReopen in devcontainerという選択肢が現れます。クリックするとそのフォルダがコンテナの中で開かれます。初めて構築するときは時間がかかるはずです。

ここまでできたらmastodonの構築は完成！あとは実際にサーバーを立ててログインしてみましょう。

devcontainerでフォルダを開くと写真のようなターミナルが現れるはずです。そこに

# foreman start

と打ってみましょう。エラーが出るかもしれません。その時は

# gem install foreman

と打ってみましょう。それからもう一度打ってみてください。サーバーが立つはずです。このとき、ポートのところから実際にブラウザを開くことができます。その際のIDとpasswordについては、

。。。。。。

これでmastodonの立ち上げは終了です！

続いてデバッグのやり方を紹介しておきます。先に言っておくと、mastodonはフロントエンド、バックエンド、データベースから成り立っており、デバッグはそのうちのフロントエンドの動きについてのみ観察することができます。なのでデバッグをしても裏で何が起こっているのか知ることはできません。もし知りたくなったら、自分でコードを漁ってみてください。

VScodeを見ると左の方に再生ボタンのようなものがあります。それをクリックすると

写真を挿入

ここに「launch.json ふぁいるを作成します。」という文字が出てくるはずです。これをクリックすると実際にファイルが作られます。その際にWebアプリの選択を要求されますがchromeを選択しておきましょう。すると

写真を挿入

このようなファイルが現れます。そのurlの部分の番号、最初の時点では8000になっているかもしれませんがその数字を自分のサーバーのポート番号に変更してください。筆者の環境では3000と変更しました。すると左上に「localhostに対してchromeを起動する」と現れるのでそれをクリックしましょう。するとchromeが立ち上がるはずです。

起動ができたらコード中の怪しいところにブレイクポイントを設置しましょう。chrome上でやりたい操作をしたときにターミナル上で止まってくれるはずです。ブレイクポイントで止まったら1ステップずつ探索していくことが可能です。

このように実行とデバッグという文字が出てくるはずです。

デバッグについてはこれで以上！これでフロントエンドの仕組みはわかるはず！